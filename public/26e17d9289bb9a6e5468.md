---
title: Rails7.0 + Herokuã§åˆã‚ã¦ã®æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤!!
tags:
  - Ruby
  - Rails
  - GitHub
  - Heroku
  - ãƒ‡ãƒ—ãƒ­ã‚¤
private: false
updated_at: '2023-02-20T14:54:39+09:00'
id: 26e17d9289bb9a6e5468
organization_url_name: null
slide: false
ignorePublish: false
---
## ã‚„ã£ãŸã“ã¨
Ruby on Railsã§ä½œæˆã—ãŸè‡ªä½œã‚¢ãƒ—ãƒªã‚’Herokuã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã—ãŸã€‚
ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ä¸Šã§å¤šæ§˜ãªæƒ…å ±ã«åŸ‹ã‚‚ã‚Œã¦ã‹ãªã‚Šè©°ã¾ã£ãŸã®ã§ã€ãã®æ–¹æ³•ãƒ»æ‰‹é †ã‚’æ•´ç†ã—ã¦ã„ãã¾ã™ï¼

## é–‹ç™ºç’°å¢ƒ
* macOS Monterey
* Ruby 3.1.2
* Ruby on Rails 7.0.4
* Heroku
* MySQL 8.0
* GitHub

# ãƒ‡ãƒ—ãƒ­ã‚¤ã®æ‰‹é †
1. Railsä¸Šã®ãƒ•ã‚¡ã‚¤ãƒ«ã®è¨­å®š
1. Herokuã®ç™»éŒ²ãƒ»è¨­å®š
1. ï¼ˆ:construction:WIPï¼‰è¿½åŠ ã®è¨­å®šï¼ˆSSL, Redis, credentials, ActiveStorageï¼‰ã€€

## 1. Railsä¸Šã®ãƒ•ã‚¡ã‚¤ãƒ«ã®è¨­å®š
1. config/database.ymlã«ã¤ã„ã¦ã¯ã€`DATABASE_URL`ã¨ã„ã†ç’°å¢ƒå¤‰æ•°ã‚’Herokuä¸Šã§å¾Œã«è¨­å®šã™ã‚Œã°ãã‚Œä»¥å¤–ã®ç’°å¢ƒå¤‰æ•°ã¯ä¸è¦ã€‚ï¼ˆ[å‚è€ƒ](https://qiita.com/dawn_628/items/4160fec4f476491c1953)ï¼‰
    ```yml:config/database.yml
    production:
      <<: *default
    ```
1. config/environments/production.rbã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã¾ã¾ã§OKã€‚ï¼ˆ[å‚è€ƒ](https://qiita.com/jnchito/items/3d225112a3ac95379b1d)ï¼‰

1. Procfileã®ä½œæˆï¼ˆ[å‚è€ƒ](https://devcenter.heroku.com/ja/articles/procfile)ï¼‰
    ã‚µãƒ¼ãƒãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ–ãƒ¼ãƒˆæ–¹æ³•ã‚’æ˜è¨˜ã€‚
    ```:Procfile
    web: bin/rails server -p $PORT -e $RAILS_ENV
    worker: bundle exec sidekiq
    ```

1. ä¸Šè¨˜ã®å¤‰æ›´ã‚’gitã«ã‚³ãƒŸãƒƒãƒˆã—ã¦ãŠãã€‚

## 2. Herokuã®ç™»éŒ²ãƒ»è¨­å®š
1. [ã“ã¡ã‚‰](https://signup.heroku.com/)ã‹ã‚‰Herokuã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ

1. Heroku CLIã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    ```sh
    $ brew tap heroku/brew && brew install heroku
    ```
1. Herokuã«ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆ â†’ herokuã‚³ãƒãƒ³ãƒ‰ãŒä½¿ãˆã‚‹çŠ¶æ…‹ã«ï¼‰
    ```sh
    $ heroku login
    ```

1. Herokuä¸Šã§ã‚¢ãƒ—ãƒªã‚’ä½œæˆã€‚ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’HerokuãŒå—ã‘å–ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚`heroku`ã¨ã„ã†ãƒªãƒ¢ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªãŒè¿½åŠ ã•ã‚Œã‚‹ã€‚`<ã‚¢ãƒ—ãƒªå>`ã«ã¯è‡ªèº«ã®ã‚¢ãƒ—ãƒªã®åå‰ã‚’å…¥ã‚Œã‚‹ã€‚ï¼ˆãŸã ã—é‡è¤‡ä¸å¯ï¼‰
    ```sh
    $ heroku apps:create <ã‚¢ãƒ—ãƒªå>
    ```

1. æœ¬ç•ªç’°å¢ƒã§MySQLã‚’ä½¿ã†ãŸã‚ã«JawsDBã‚¢ãƒ‰ã‚ªãƒ³ã‚’è¿½åŠ ã€‚`<ãƒ—ãƒ©ãƒ³å>`ã«ã¯ç¾æ™‚ç‚¹ã§ç„¡æ–™ãƒ—ãƒ©ãƒ³ã®`kitefin`ã‚’å…¥ã‚ŒãŸã€‚
ï¼ˆ[JawsDBã‚’ä½¿ã†ç†ç”±](https://qiita.com/haruyan_hopemucci/items/14e0dbeb0aedd85a74ee)ã€[MySQLã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®šæ–¹æ³•](https://dhate.hatenablog.com/entry/2019/12/08/012312)ï¼‰
    ```sh
    heroku addons:create jawsdb:<ãƒ—ãƒ©ãƒ³å> -a <ã‚¢ãƒ—ãƒªå> --version=8.0
    ```
    
1. Herokuä¸Šã§ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šï¼ˆ[å‚è€ƒ](https://qiita.com/murakami-mm/items/9587e21fc0ed57c803d0)ï¼‰
    â‘  JawsDBã®URLã‚’ç¢ºèª
    ```sh
    $ heroku config
    === karoyaka Config Vars
    JAWSDB_URL: mysql://<ãƒ¦ãƒ¼ã‚¶ãƒ¼å>:<ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰>@<ãƒ›ã‚¹ãƒˆ>:<ãƒãƒ¼ãƒˆç•ªå·>/<ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å>
    ```

    â‘¡ ç¢ºèªã—ãŸURLã‚’ã€ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦è¨­å®šã—ã¦ã„ãã€‚`mysql2` gemã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã€`DATABASE_URL`ã§ã¯`mysql2://`ã‚¹ã‚­ãƒ¼ãƒã‚’ä½¿ã†ã€‚ï¼ˆ[å‚è€ƒ](https://devcenter.heroku.com/articles/jawsdb#using-jawsdb-with-rails)ï¼‰
    ```sh
    $ heroku config:set DATABASE_URL='mysql2://<ãƒ¦ãƒ¼ã‚¶ãƒ¼å>:<ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰>@<ãƒ›ã‚¹ãƒˆ>/<ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å>?reconnect=true'
    ```
1. Herokuä¸Šã¸ãƒ‡ãƒ—ãƒ­ã‚¤ã€‚`main`ãƒ–ãƒ©ãƒ³ãƒä»¥å¤–ã‹ã‚‰ã®ãƒ—ãƒƒã‚·ãƒ¥æ™‚ã¯ã€`<ç¾åœ¨ã®ãƒ–ãƒ©ãƒ³ãƒå>:main`ã¨æ›¸ã‘ã°OKã€‚ä»Šå¾Œã‚‚ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ã®ãŸã³ã«ã“ã®ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ã¤ã€‚
    ```sh
    $ git push heroku main
    ```
1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    ```
    $ heroku run rails db:migrate
    ```

1. ç”»åƒãƒ—ãƒ­ã‚»ãƒƒã‚µVipsã‚’å‹•ã‹ã™ã®ã«å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç†ç”±ã¯ã€ç”»åƒã‚µã‚¤ã‚ºã®æ“ä½œã®ãŸã‚ã«`variant`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã£ã¦ã„ã‚‹ãŸã‚ã€‚ï¼ˆ[å‚è€ƒâ‘ ](https://qiita.com/west2538/items/da8c33749993d17c67e2#heroku%E3%81%AB%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4)ã€[å‚è€ƒâ‘¡](https://tosbourn.com/vips-rails-7-heroku/)ï¼‰
    ```sh
    $ heroku stack:set heroku-20 # ãƒ“ãƒ«ãƒ‰ãƒ‘ãƒƒã‚¯ã®å¯¾è±¡å†…ã®stackã«å¤‰æ›´
    $ heroku buildpacks:add --index 1 https://github.com/heroku/heroku-buildpack-apt
    $ heroku buildpacks:add --index 2 https://github.com/brandoncc/heroku-buildpack-vips
    $ cat <<EOF >Aptfile
    > libglib2.0-0
    > libglib2.0-dev
    > libpoppler-glib8
    > EOF
    ```
    â†’ ã‚³ãƒŸãƒƒãƒˆ & ãƒ‡ãƒ—ãƒ­ã‚¤

1. ã‚¢ãƒ—ãƒªã‚’é–‹ã !! ğŸ¥³
    ```sh
    $ heroku open
    ``` 

## 3. ï¼ˆ:construction:WIPï¼‰è¿½åŠ ã®è¨­å®š
 â€» ä½œæ¥­é€”ä¸­ã€‚ã“ã‚Œã‹ã‚‰è¨­å®šã—ã¦ã„ãã¾ã™ã€‚

1. config/master.key ï¼ˆ[å‚è€ƒâ‘ ](https://ameblo.jp/kumakou1234/entry-12640310364.html)ã€[å‚è€ƒâ‘¡](https://yukitoku-sw.hatenablog.com/entry/2020/02/04/145331)ï¼‰


1. config/initializers/sessions_store.rb ? 
    1. [Rails ã® session store ã« Heroku Redis ã‚’åˆ©ç”¨ã™ã‚‹](https://qiita.com/NaokiIshimura/items/024c3d35ddc3188a0524)
    
1. config/environments/production.rbãƒ•ã‚¡ã‚¤ãƒ«ã§ã€config.force_ssl = trueã‚’è¿½åŠ ã—ã€HTTPSã‚’å¼·åˆ¶ã™ã‚‹ã‚ˆã†ã«

1. ActiveStorageã‚’S3ã«è¨­å®š
